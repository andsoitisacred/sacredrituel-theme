<div id="AjaxCartSubtotal">
  <div class="cart__footer {% if cart.item_count == 0 %} cart--empty {% endif %}">
    {% comment %}
      {%- if settings.cart_notes_enable -%}
        <textarea
          name="note"
          id="cartSpecialInstructions"
          placeholder="{{ 'cart.note' | t }}"
          aria-label="{{ 'cart.note' | t }}"
          form="cart"
          maxlength="250"
          placeholder="Write your gift message here...">{{ cart.note }}</textarea>
      {%- endif -%}
    {% endcomment %}

    {% comment %}
      Temporary Gift note instructions
    {% endcomment %}

    {%- assign show_gift_message = false -%}
    {%- for item in cart.items -%}
      {%- if item.product.tags contains 'gift-wrapped-note' -%}
        {%- assign show_gift_message = true -%}
      {%- endif -%}
    {%- endfor -%}

    {%- if show_gift_message -%}
      <div class="gift-note-wrapper" style="margin-top: 8px;">
        <label for="cartSpecialInstructions">Mother's Day Gift Message</label>
        <textarea
          name="note"
          id="cartSpecialInstructions"
          maxlength="250"
          placeholder="Write your message to be written and included in your gift."
          aria-label="{{ 'cart.note' | t }}"
          form="cart"
          style="margin-top: 8px;"
        >{{ cart.note }}</textarea>
        <p id="cart-note-counter" style="font-size: 0.85em; color: #888;">{{ cart.note | size }}/250 characters</p>
      </div>

      <script>
    const noteField = document.getElementById('cartSpecialInstructions');
    const counter = document.getElementById('cart-note-counter');
    if (noteField) {
      noteField.addEventListener('input', function () {
        counter.textContent = `${this.value.length}/250 characters`;
      });
    }
      </script>

      <style>
        .gift-note-wrapper {
          margin-bottom: 1.5rem;
        }
        #cartSpecialInstructions {
          width: 100%;
          padding: 0.75rem;
          border: 1px solid #ccc;
          border-radius: 8px;
          font-family: inherit;
        }
      </style>
    {%- endif -%}

    <div class="cart-out">
      <div id="CartDetails">
        {%- if cart.cart_level_discount_applications != blank -%}
          <div>
            <p id="CartSubTotal">
              {{ 'cart.subtotal' | t }}
              <span>{{ cart.items_subtotal_price | money }}</span>
            </p>
            <p id="CartDiscounts">
              {{ 'cart.discounts' | t }}
              {%- for discount_application in cart.cart_level_discount_applications -%}
                <span style="display: inline-block">
                  {{- discount_application.title }}
                  <span style="display: inline-block"
                    >(-{{ discount_application.total_allocated_amount | money | strip }})</span
                  >
                </span>
              {%- endfor -%}
            </p>
          </div>
        {%- endif -%}
      </div>

      <p id="CartTotal">
        {{ 'cart.total' | t }}
        <span>{{ cart.total_price | money }}</span>
      </p>
      <span class="info">
        {%- liquid
          if cart.taxes_included and shop.shipping_policy.body != blank
            echo 'cart.policies.taxes_included_and_shipping_policy_html' | t: link: shop.shipping_policy.url
          elsif cart.taxes_included
            echo 'cart.policies.taxes_included_but_shipping_at_checkout' | t
          elsif shop.shipping_policy.body != blank and localization.country.iso_code == 'US' and cart.total_price < 9000
            echo '$7.00 flat-rate shipping. Taxes calculated at checkout.'
          elsif shop.shipping_policy.body != blank and localization.country.iso_code == 'US' and cart.total_price >= 9000
            echo 'Taxes calculated at checkout.'
          elsif shop.shipping_policy.body != blank
            echo 'cart.policies.taxes_and_shipping_policy_at_checkout_html' | t: link: shop.shipping_policy.url
          else
            echo 'cart.policies.taxes_and_shipping_at_checkout' | t
          endif
        -%}
      </span>

      <div class="cart-actions buttons-holder {% if additional_checkout_buttons and settings.cart_additional_buttons and type == 'page' %} cart-actions--additional-checkout-buttons {% endif %}">
        <a
          id="ViewCart"
          href="{{ routes.cart_url }}"
          class="button button--border button--align"
        >
          {{- 'cart.view_cart' | t -}}
        </a>

        <noscript>
          <button
            name="update"
            class="button button--border button--wide"
            form="cart"
          >
            {{ 'cart.update' | t }}
          </button>
        </noscript>

        <button
          id="CheckOut"
          class="button button--solid {% if additional_checkout_buttons and settings.cart_additional_buttons and type == 'page' %} button--wide {% endif %}"
          type="submit"
          name="checkout"
          form="cart"
        >
          {{ 'cart.checkout' | t }}
        </button>

        {%- unless template contains 'order' -%}
          {%- if additional_checkout_buttons and settings.cart_additional_buttons -%}
            <div class="additional-checkout-buttons additional-checkout-buttons--vertical">
              {{ content_for_additional_checkout_buttons }}
            </div>
          {%- endif -%}
        {%- endunless -%}
      </div>
    </div>

    <div class="cart-continue">
      <a href="/pages/natural-skincare-best-sellers" class="button button--solid button--wide button--align">
        <span>{{ 'cart.continue_browsing' | t }}</span>
      </a>
    </div>
  </div>
</div>
